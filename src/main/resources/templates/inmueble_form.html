<html xmlns:th="http://www.thymeleaf.org">
    <head th:replace = "/fragments/head :: head"/><!--
        <link href="/css/inmueble_form.css" rel="stylesheet" type="text/css"/>
    </head>-->
    <body>
        <header th:replace="/fragments/header :: header"></header>
        <nav th:replace="/fragments/nav :: nav"></nav>
        <div class="container-fluid m-5 contenedor">
            <div class="contenedor_inmueble">
                <form class="formulario_inmueble" th:action="@{/inmueble/registro}" method="POST" enctype="multipart/form-data">
                    <h3 class="titulo">Cargar Inmueble</h3>
                    <p></p>
                    <select name="Tipo de propiedad" class="searcher-form">
                        <option value="" disabled selected>Tipo de vivienda</option>
                        <option value="1">Departamento</option>
                        <option value="2">PH</option>
                        <option value="3">Casa</option>
                        <option value="4">Terreno y lotes</option>
                        <option value="5">Cochera</option>
                        <option value="6">Local</option>
                        <option value="7">Oficina</option>
                        <option value="8">Consultorio</option>
                        <option value="9">Quinta</option>
                        <option value="10">Chacra</option>
                        <option value="11">Galpon</option>
                        <option value="12">Deposito</option>
                        <option value="13">Campo</option>
                        <option value="14">Hotel</option>
                        <option value="15">Fondo de comercio</option>
                        <option value="16">Edificio</option>
                        <option value="17">Otros</option>
                    </select>

                    <div class="form-group my-3">
                        <input type="number" class="form-control" name="antiguedad" placeholder="Antiguedad del inmueble" th:value="${antiguedad}">
                    </div>

                    <div class="form-group my-3">
                        <input type="number" class="form-control" name="mts2" placeholder="Metros cuadrados del inmueble" th:value="${mts2}">
                    </div>

                    <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            const $selectProvincias = document.getElementById("provincias");
                            const $selectMunicipios = document.getElementById("municipios");

                            function provincia() {
                                fetch("https://apis.datos.gob.ar/georef/api/provincias")
                                        .then((res) => (res.ok ? res.json() : Promise.reject(res)))
                                        .then((json) => {
                                            let $options = `<option value="Elige una provincia">Elige una provincia</option>`;

                                            json.provincias.forEach(
                                                    (el) => ($options += `<option value="${el.nombre}">${el.nombre}</option>`)
                                            );

                                            $selectProvincias.innerHTML = $options;
                                        })
                                        .catch((error) => {
                                            let message = error.statusText || "Ocurri칩 un error";
                                            $selectProvincias.nextElementSibling.innerHTML = `Error: ${error.status}: ${message}`;
                                        });
                            }

                            function municipio(provincia) {
                                fetch(
                                        `https://apis.datos.gob.ar/georef/api/municipios?provincia=${provincia}&max=100`
                                        )
                                        .then((res) => (res.ok ? res.json() : Promise.reject(res)))
                                        .then((json) => {
                                            let $options = `<option value="Elige un municipio">Elige un municipio</option>`;

                                            json.municipios.forEach(
                                                    (el) => ($options += `<option value="${el.id}">${el.nombre}</option>`)
                                            );

                                            $selectMunicipios.innerHTML = $options;
                                        })
                                        .catch((error) => {
                                            let message = error.statusText || "Ocurri칩 un error";
                                            $selectMunicipios.nextElementSibling.innerHTML = `Error: ${error.status}: ${message}`;
                                        });
                            }

                            $selectProvincias.addEventListener("change", (e) => {
                                municipio(e.target.value);
                                console.log(e.target.value);
                            });

                            provincia(); // Llamada inicial para cargar las provincias al cargar la p치gina
                        });
                    </script>
                    <select id="provincias" class="searcher-form" name='provincia'>
                        <option value="" disabled selected>Elige una provincia</option>
                    </select>

                    <select id="municipios" class="searcher-form" name='departamento'>
                        <option value="" disabled selected>Elige un municipio</option>
                    </select>

                    <div class="form-group my-3">
                        <input type="text" class="form-control" name="direccion" placeholder="Direccion del inmueble" th:value="${direccion}">
                    </div>
                    <div class="form-group my-3">
                        <input type="number" class="form-control" name="precio" placeholder="Valor del Inmueble" th:value="${precio}">
                    </div>
                    <div class="form-group my-3">
                        <input type="file" class="form-control" name="archivo" th:value="${archivo}" >
                    </div>
                    <div class="form-group my-3">
                        <input type="text" class="form-control" name="descripcion" placeholder="Descripcion del inmueble" th:value="${descripcion}">
                    </div>

                    <button type="submit" class="btn btn-primary mt-3 botones">Guardar</button>
                </form>
            </div>
            <section class="text-center container">
                <div class="row mt-3">
                    <div class="divVolver">
                        <a th:href="@{/}" class="botonVolver">Volver</a>
                    </div>
                </div>
            </section>
        </div>
        <!-- Secci칩n del Footer -->
        <footer th:replace="/fragments/footer :: footer"></footer>
        <script src="index.js"></script>
    </body>
</html>



